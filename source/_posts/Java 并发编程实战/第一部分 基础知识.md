---
date: 2021-10-27
cover: https://img2.doubanio.com/view/subject/l/public/s7663093.jpg
---

# 第一部分 基础知识

## 线程安全性

### 什么是线程安全性

> 当多个线程访问某个类时，这个类始终都能表现出正确的行为，那么就称这个类是线程安全的。

### 原子性

#### 竞态条件 Race Condition

> 当某个计算的正确性取决于多个线程的交替执行时序时，那么就会发生竞态条件
> 大多是竞态条件的本质：基于一种可能失效的观察结果来做出判断或者执行某个计算

> 先检查后执行是最常见的竞态条件
> 读取-修改-写入 是另一种竞态条件

#### 原子操作

> 要避免竞态条件问题，就必须在某个线程修改变量时，通过**某种方式**防止其他线程使用这个变量，从而确保其他线程只能在修改操作完成之前或之后读取和修改状态，而不是在修改状态的过程中

> 原子操作是指，对于访问同一个状态的所有操作(包含该操作本身)来说，这个操作是一个以原子方式执行的操作
> 原子性：一组操作，要么全部执行，要么全部不执行

> 复合操作：包含了一组必须以原子方式执行的操作

### 加锁机制

> 要保持状态的一致性，就需要在单个原子操作中更新所有相关的状态变量

#### 内置锁 `synchronized`

> 同步代码块包括两个部分：一个作为锁的对象引用，一个作为由这个锁保护的代码块

```java
synchronized (lock) {
 // 访问或者修改由锁保护的共享状态
}
```

> 每个 Java 对象都可以作为一个实现同步的锁，这个锁统称为内置锁